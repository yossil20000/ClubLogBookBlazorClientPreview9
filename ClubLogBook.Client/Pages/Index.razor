@page "/index"

@using ClubLogBook.Application.ViewModels

<AuthorizeView>
    <Authorized>
        <h1>Hello @context.User.Identity.Name !!</h1>

        <p>Welcome to your new app.</p>

        <SurveyPrompt Title="How is Blazor working for you?" />
    </Authorized>
    <Authorizing>
        <h1>Loading ...</h1>
    </Authorizing>
    <NotAuthorized>
        <div class="d-flex justify-content-start"><label>Aa</label><label>Aa</label><label>Aa</label><label>Aa</label></div>
        <div class="d-flex justify-content-end"><label>Aa</label><label>Aa</label><label>Aa</label><label>Aa</label></div>
        <div class="d-flex justify-content-center"><label>Aa</label><label>Aa</label><label>Aa</label><label>Aa</label></div>
        <div class="d-flex justify-content-between"><label>Aa</label><label>Aa</label><label>Aa</label><label>Aa</label></div>
        <div class="d-flex justify-content-around"><label>Aa</label><label>Aa</label><label>Aa</label><label>Aa</label></div>
        <div class="d-flex justify-content-xl-around"><label>Aa</label><label>Aa</label><label>Aa</label><label>Aa</label></div>
        <div class="d-flex justify-content-center"><h1>Welcome To the Club</h1></div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-2"></div>
                <div class="col-8">
                    <div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img class="d-block w-100" src="/Image/PPL_4186280_Front_30_05_19.JPG"
                                     alt="First slide">
                            </div>
                            <div class="carousel-item">
                                <img class="d-block w-100" src="/Image/scrapImageRepo.jpg"
                                     alt="Second slide">
                            </div>
                            <div class="carousel-item">
                                <img class="d-block w-100" src="/Image/stress08.51.34.jpg"
                                     alt="Third slide">
                            </div>
                        </div>
                        <a class="carousel-control-prev" href="#carouselExampleFade" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselExampleFade" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <div class="col-2"></div>
            </div>
        </div>
    </NotAuthorized>
</AuthorizeView>

<h1>My guestbook</h1>

<p>Leave me a message if you like my site</p>
<div class="modal" tabindex="-1" style="display:block" role="dialog">
    <div class="modal-dialog  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <EditForm EditContext="@EditContext">
                    <DataAnnotationsValidator />

                    <div class="form-group">
                        <label for="name">Name: </label>
                        <InputText Id="name" Class="form-control" @bind-Value="@Model.IdNumber" @onkeyup='@(e => KeyUp(e, "IdNumber"))'></InputText>
                        <ValidationMessage For="@(() => Model.IdNumber)" />
                    </div>
                    <div class="form-group">
                        <label for="body">Text: </label>
                        <InputTextArea Id="body" Class="form-control" @bind-Value="@Model.TailNumber" @onkeyup='@(e => KeyUp(e, "TailNumber"))'></InputTextArea>
                        <ValidationMessage For="@(() => Model.TailNumber)" />
                    </div>
                    <button type="submit" disabled="@OkayDisabled">Ok</button>

                </EditForm>
            </div>
        </div>
        </div>
    </div>

    

    @code
{
        private EditContext EditContext;
        private FlightReservationViewModel Model = new FlightReservationViewModel();

        protected string OkayDisabled { get; set; } = "disabled";

        protected override void OnInitialized()
        {
            EditContext = new EditContext(Model);
            EditContext.OnFieldChanged += EditContext_OnFieldChanged;

            base.OnInitialized();
        }

        protected override void OnAfterRender(bool first)
        {
            base.OnAfterRender(first);

            SetOkDisabledStatus();
        }

        private void EditContext_OnFieldChanged(object sender, FieldChangedEventArgs e)
        {
            SetOkDisabledStatus();
        }

        void KeyUp(KeyboardEventArgs e, string memberName)
        {
            var property = Model.GetType().GetProperty(memberName);
            var value = property.GetValue(Model);
            //property.SetValue(Model, value + e.Key);

            var id = EditContext.Field(memberName);

            EditContext.NotifyFieldChanged(id);
        }

        private void SetOkDisabledStatus()
        {
            if (EditContext.Validate())
            {
                OkayDisabled = null;
            }
            else
            {
                OkayDisabled = "disabled";
            }
        }
    }
